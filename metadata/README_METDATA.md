# üßæ Static Dreamscapes ‚Äî Metadata Reference

> Documentation for the **metadata layer** of the Static Dreamscapes Automation System.  
> This folder stores all structured JSON data generated by `analyze_audio.py` and maintained by `orchestrator.py`.  
> Metadata acts as the central record of every analyzed track, grouped by phase and aggregated into indexes and histories.

---

## üóÇÔ∏è Folder Overview

| File / Folder                       | Description                                                          |
| ----------------------------------- | -------------------------------------------------------------------- |
| `Phase_1.json`                      | Metadata for "Calm Intro" tracks (Phase 1).                          |
| `Phase_2.json`                      | Metadata for "Flow / Focus" tracks (Phase 2).                        |
| `Phase_3.json`                      | Metadata for "Uplift / Clarity" tracks (Phase 3).                    |
| `Phase_4.json`                      | Metadata for "Reflective Fade" tracks (Phase 4).                     |
| `song_index.json`                   | Master index containing all songs across all phases.                 |
| `build_history.json`                | Historical record of previous mix builds, durations, and selections. |
| `metadata_schema.json` _(optional)_ | JSON Schema definition for validation or type checking.              |

---

## üß© 1Ô∏è‚É£ Phase Metadata Files

Each phase JSON (`Phase_X.json`) represents the set of tracks belonging to that arc.  
These files are written by `analyze_audio.py` and used later by the orchestrator or playlist builder.

**Example: `/metadata/Phase_1.json`**

```json
{
  "phase": 1,
  "label": "Calm Intro",
  "description": "Ambient, nostalgic introduction tracks that set tone and atmosphere.",
  "tracks": [
    {
      "file_name": "A_001_SoftGlare.mp3",
      "title": "Soft Glare",
      "artist": "Suno",
      "duration_sec": 412,
      "bpm": 72,
      "rms": 0.118,
      "brightness": 2381.42,
      "key_guess": "C Major",
      "created_at": "2025-10-29T23:12:03Z",
      "phase_position": 1
    },
    {
      "file_name": "A_002_DreamTape.mp3",
      "title": "Dream Tape",
      "artist": "Suno",
      "duration_sec": 389,
      "bpm": 78,
      "rms": 0.101,
      "brightness": 2509.91,
      "key_guess": "F Major",
      "created_at": "2025-10-29T23:17:42Z",
      "phase_position": 2
    }
  ]
}
```

---

### üß† Field Notes

| Field            | Type    | Description                                         |
| ---------------- | ------- | --------------------------------------------------- |
| `phase`          | Integer | Phase number (1‚Äì4).                                 |
| `label`          | String  | Human-readable phase name.                          |
| `tracks`         | Array   | List of analyzed tracks.                            |
| `file_name`      | String  | Actual file name in `/Arc_Library/`.                |
| `title`          | String  | Track title (auto-parsed or derived from filename). |
| `duration_sec`   | Number  | Length in seconds.                                  |
| `bpm`            | Number  | Estimated tempo.                                    |
| `rms`            | Number  | Loudness measure (Root Mean Square).                |
| `brightness`     | Number  | Mean spectral centroid (tonal brightness).          |
| `key_guess`      | String  | Estimated musical key (e.g., "A minor").            |
| `phase_position` | Integer | Position within this phase.                         |

---

## üß© 2Ô∏è‚É£ Master Index

`/metadata/song_index.json` is the aggregated registry of every analyzed track, across all phases.

This file allows the AI agent or external tools (e.g. playlist generators or web dashboards) to query and sort by attributes like BPM, duration, or tonal characteristics.

**Example: `/metadata/song_index.json`**

```json
{
  "last_updated": "2025-10-29T23:35:00Z",
  "total_tracks": 48,
  "phases": [1, 2, 3, 4],
  "tracks": [
    {
      "phase": 2,
      "file_name": "B_004_AnalogSky.mp3",
      "title": "Analog Sky",
      "duration_sec": 354,
      "bpm": 92,
      "rms": 0.131,
      "brightness": 2790.45,
      "key_guess": "D Major",
      "phase_position": 3
    },
    {
      "phase": 3,
      "file_name": "A_009_NightRun.mp3",
      "title": "Night Run",
      "duration_sec": 402,
      "bpm": 108,
      "rms": 0.126,
      "brightness": 3154.22,
      "key_guess": "G# Minor",
      "phase_position": 2
    }
  ]
}
```

---

### üß† Usage Notes

The orchestrator merges all `Phase_X.json` files into this index after analysis.

This is the primary metadata entry point for any external automation (e.g., track selection, curation AI, or web dashboards).

The AI agent can use this file to:

- Generate balanced playlists across phases.
- Track reuse of existing songs.
- Avoid duplicate selections in new mixes.

---

## üß© 3Ô∏è‚É£ Build History

`/metadata/build_history.json` keeps a record of all previous mix builds.  
This includes timestamps, track selections, and duration summaries for transparency and reproducibility.

**Example: `/metadata/build_history.json`**

```json
{
  "builds": [
    {
      "build_id": "mix_2025_10_29_01",
      "timestamp": "2025-10-29T23:45:10Z",
      "phases_used": [1, 2, 3, 4],
      "total_tracks": 48,
      "final_duration_sec": 10780,
      "mix_file": "Rendered/Final_Mix_2025_10_29.mp3",
      "crossfade_sec": 3,
      "average_bpm": 88.5,
      "average_rms": 0.124,
      "notes": "First mix using reusable song bank"
    }
  ]
}
```

---

### üß† Field Notes

| Field                | Type    | Description                                           |
| -------------------- | ------- | ----------------------------------------------------- |
| `build_id`           | String  | Unique identifier for the rendered mix (date-based).  |
| `timestamp`          | String  | ISO timestamp of mix completion.                      |
| `phases_used`        | Array   | List of phase numbers included in the build.          |
| `total_tracks`       | Integer | Number of tracks in this mix.                         |
| `final_duration_sec` | Number  | Verified total length of final mix.                   |
| `mix_file`           | String  | Path to rendered mix file.                            |
| `crossfade_sec`      | Number  | Crossfade duration used.                              |
| `average_bpm`        | Number  | Mean BPM across all tracks.                           |
| `average_rms`        | Number  | Mean RMS (loudness).                                  |
| `notes`              | String  | Optional contextual info (e.g., "Halloween release"). |

---

## üß© 4Ô∏è‚É£ Metadata Schema (Optional)

You can include `/metadata/metadata_schema.json` as a formal JSON Schema to help the AI agent validate or generate metadata.

**Example Schema Snippet:**

```json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Static Dreamscapes Metadata Schema",
  "type": "object",
  "properties": {
    "file_name": { "type": "string" },
    "duration_sec": { "type": "number" },
    "bpm": { "type": "number" },
    "rms": { "type": "number" },
    "brightness": { "type": "number" },
    "key_guess": { "type": "string" },
    "phase": { "type": "integer" },
    "phase_position": { "type": "integer" }
  },
  "required": ["file_name", "duration_sec", "bpm", "rms", "phase"]
}
```

This file can optionally be used by `orchestrator.py` or validation scripts to confirm that all new metadata adheres to expected structure.

---

## üß† Integration Summary

| Source             | Produces                                         | Consumes                      |
| ------------------ | ------------------------------------------------ | ----------------------------- |
| `analyze_audio.py` | `Phase_X.json`, `song_index.json`                | Reads `.mp3` files            |
| `orchestrator.py`  | `build_history.json`, merged metadata            | Reads all phase + index files |
| `build_mix.sh`     | References `song_index.json`                     | Writes logs to `Rendered/`    |
| Future curation AI | Reads `song_index.json` and `build_history.json` | Generates playlist configs    |

---

## üß∞ Maintenance Notes

- Each JSON file should be UTF-8 encoded and human-readable.
- Keep numeric values as floats or integers ‚Äî no strings for duration/BPM.
- The orchestrator automatically overwrites older metadata when regenerating.
- Consider committing metadata snapshots to Git if you want historical tracking of analytics evolution.
- If using schema validation, run:

```bash
python3 -m jsonschema -i metadata/song_index.json metadata/metadata_schema.json
```

---

## ‚úÖ Related Documentation

- `agent/orchestrator.py` ‚Äî central pipeline controller
- `agent/analyze_audio.py` ‚Äî metadata generation engine
- `05_AUDIO_ANALYSIS.md` ‚Äî deep dive into feature extraction
- `README_AGENT.md` ‚Äî AI agent layer reference
